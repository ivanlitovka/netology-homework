**1. Обнаруженные следы компрометации**

- Автозагрузка вредоносного кода:

    - Модифицированная переменная окружения UserInitMprLogonScript указывающая на файл Updater.bat
    Файл расположен в директории: C:\Users\Wilfred\AppData\Roaming\Identities\Updater.bat
    Файл содержит powershell-скрипт зашифрованный base64. Анализ скрипта показал что при выполнении происходит следующие: 
        - Проверка версии PowerShell: Скрипт проверяет, установлена ли версия PowerShell 3 или выше. Если да, то он продолжает выполнение.
        - Отключение журналирования скриптов: Скрипт отключает функции журналирования, такие как EnableScriptBlockLogging и EnableScriptBlockInvocationLogging. Это может быть полезно для скрытия действий, выполняемых в PowerShell.
        - Создание словаря: Скрипт создает словарь для хранения настроек, связанных с журналированием, и устанавливает значения для отключения журналирования.
        - Настройка реестра: Скрипт изменяет параметры в реестре, чтобы отключить журналирование на уровне системы.
        - Загрузка данных: Скрипт загружает данные с указанного URL (http://192.168.1.71:80/news.php) и использует их для выполнения дальнейших действий.
        - Декодирование данных: Загруженные данные декодируются с использованием алгоритма XOR и ключа, указанного в скрипте.
        - Выполнение команд: Декодированные данные интерпретируются и выполняются как команды PowerShell.

- Вредоносные файлы:
    iepv.exe и netscan.exe в Temp
    Архивы: iepv.zip, netscan_portable.zip
    Файл с паролями: passwords.txt
    1 (файл содержит обфусцированный код powershell-скрипта)

- Сетевые следы:
    Подключенные удаленные серверы:
        192.168.1.75
        192.168.1.72

- Аккаунт пользователя: Wilfred

**2. Хронология инцидента**
Фаза 1: Внедрение
- Загрузка архивов в Temp директорию
- Распаковка содержимого архивов
- Создание файлов iepv.exe и netscan.exe

Фаза 2: Закрепление
- Модификация системных переменных
- Размещение вредоносного скрипта в автозагрузке
- Установка удаленного доступа через RDP

Фаза 3: Эксплуатация
- Запуск вредоносных исполняемых файлов
- Создание файла с паролями
- Установление сетевых подключений

**3. Маппинг по MITRE ATT&CK**
Матрица MITRE ATT&CK для инцидента

| Этап                                        | Техники                                                                  |
|---------------------------------------------|--------------------------------------------------------------------------|
| Initial Access (Первичный доступ)           | T1195 - Spearphishing Attachment (подозрительные архивы .zip)            |
|                                             | T1203 - Exploitation for Client Execution (через загруженные файлы)      |
|                                             | T1133 - External Remote Services (использование RDP)                     |
| Execution (Выполнение)                      | T1059 - Command and Scripting Interpreter (PowerShell)                   |
|                                             | T1204 - User Execution (запуск через автозагрузку)                       |
|                                             | T1117 - Boot or Logon Autostart Execution (через UserInitMprLogonScript) |
| Persistence (Устойчивость)                  | T1547 - Boot or Logon Autostart Execution (Updater.bat в автозагрузке)   |
|                                             | T1574 - Hijack Execution Flow (изменение системных переменных)           |
|                                             | T1135 - Non-Application Layer Protocol (SSH-сервер)                      |
| Defense Evasion (Уклонение от защиты)       | T1027 - Obfuscated Files or Information (обфусцированный PowerShell)     |
|                                             | T1083 - File and Directory Permissions Modification                      |
|                                             | T1140 - Deobfuscate/Decode Files or Information                          |
| Credential Access (Доступ к учетным данным) | T1003 - Credential Dumping                                               |
|                                             | T1097 - Application Access Tokens                                        |
|                                             | T1081 - Credentials in Files (passwords.txt)                             |
| Discovery (Разведка)                        | T1016 - System Network Configuration Discovery                           |
|                                             | T1046 - Network Service Scanning (netscan.exe)                           |
|                                             | T1018 - Remote System Discovery                                          |
| Lateral Movement (Боковое перемещение)      | T1021 - Remote Services (RDP)                                            |
|                                             | T1090 - Connection Proxy (SSH)                                           |
| Collection (Сбор данных)                    | T1005 - Data from Local System                                           |
|                                             | T1560 - Archive Collected Data (создание архивов)                        |
| Exfiltration (Эксфильтрация)                | T1041 - Exfiltration Over Alternative Protocol                           |
|                                             | T1095 - Non-Standard Port                                                |
| Impact (Воздействие)                        | T1499 - Service Stop                                                     |
|                                             | T1482 - Execution as Other User                                          |

4. Рекомендации по устранению
Немедленные действия:
- Изоляция скомпрометированной системы
- Блокировка IP-адресов 192.168.1.75 и 192.168.1.72
- Удаление файлов из Temp директории
- Сброс учетных данных пользователя Wilfred
- Восстановление системы:
- Полное форматирование и переустановка ОС
- Установка последних обновлений безопасности
- Проверка целостности системных файлов
- Восстановление данных из резервных копий
- Профилактические меры:
- Внедрение системы мониторинга реестра
- Настройка IDS/IPS
- Регулярное резервное копирование
- Обучение персонала основам кибербезопасности
- Внедрение многофакторной аутентификации

5. Контроль исполнения
План мониторинга:
- Отслеживание изменений в системных файлах
- Контроль сетевой активности
- Мониторинг попыток удаленного доступа
- Регулярная проверка журналов событий

Отчетность:
- Ежедневные отчеты о состоянии системы
- Еженедельные отчеты о выявленных инцидентах
- Квартальные отчеты по эффективности мер защиты

Дополнительные материлы:
[Анализ дампа памяти](./materials/ReportMemoryDumpAnalyse.md)
[Анализ дампа диска](./materials/DiskDumpAnalyse.md)
[Сбор информации при помощи Volatility](./materials/сбор%20информации%20memory%20dump.xlsx)