### Задание 1
---
1) Развертывание инфраструктуры: 2 VM под Веб-сервер и БД  
![](/img/7.3/1.png)
![](/img/7.3/2.png)
содержимое инвентори файла для ansible
```
[yc_servers]
vm1 ansible_host=51.250.88.53
vm2 ansible_host=51.250.83.57
```

2) Установка Веб-сервера 
  
```
# tasks file for exercise 7.3
    - name: Cashe update
      apt:
        update_cache: yes

    - name: Apache installation
      apt:
        name: apache2
        state: present

    - name: Apache autoload enable
      service:
        name: apache2
        state: started
        enabled: yes

    - name: Change index.html
      template:
        src: index.j2
        dest: /var/www/html/index.html
        mode: 0644
      notify: Restart apache2   

    - name: Check that a page returns a status 200
      local_action:
        module: uri
        url: http://{{ansible_host}}
        return_content: yes
      register: site_checks
      failed_when: site_checks.status != 200


    - name: Show site status
      debug:
        msg: "{{site_checks.url}} avaible"

```
просмотр результата доступности страницы
![](/img/7.3/3.png)

просмотр страницы в браузере через внешний ip
![](/img/7.3/4.png)

### Задание 2
---
Установка PostgreSQL
```
- name: PostgreSQL
  hosts: vm2
  become: yes

  tasks:

  - name: Add repokey
    apt_key:
      url: https://www.postgresql.org/media/keys/ACCC4CF8.asc
      state: present

  - name: Add Postgre repo
    apt_repository:
      repo: deb http://apt.postgresql.org/pub/repos/apt bionic-pgdg main
      state: present

  
  - name: Update cache
    apt:
     update_cache: yes
 
  - name: Install postgresql
    apt:
     pkg: postgresql
     state: latest

  - name: Check service
    shell: systemctl status postgresql
    register: result

  - name: Show status
    debug:
      var: result

```
Проверка состояни запущенного сервиса
![](/img/7.3/5.png)
