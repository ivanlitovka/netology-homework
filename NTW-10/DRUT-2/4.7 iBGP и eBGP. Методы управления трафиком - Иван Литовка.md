# Домашнее задание к занятию 4.7 iBGP и eBGP. Методы управления трафиком.

------

### Задание 1

Топология:

![image](https://user-images.githubusercontent.com/46966420/162039656-bdd6cf34-1946-4e40-9ea7-edf602761a77.png)


Ваша компания владеет AS 100 и имеет два подключения к сети Интернет с использованием протокола BGP. 
- Канал к ISP А (AS200) дешевый и с большой пропускной способностью. 
- Канал к ISP B (AS300) меньше и менее надежный.  

Сетевое оборудование Cisco.

Стоит задача - максимально использовать первый канал для доступа в сеть Интернет.

1. Выберите технологию управления исходящим трафиком, которая с наименьшими затратами позволит решить эту задачу. 
2. Обоснуйте свой выбор.
3. Приведите пример настройки выбранной технологии, основываясь на информации отображенной на схеме.

*Приведите ответ в свободной форме.*

---

Т.к. мы используем оборудование Cisco, то тут разумно будет использовать все го возможности и технологи и для перенаправления трафика в AS200 можно организовать при помощи изменения атрибута **weight**   
```
R1(config)#router bgp 100
R1(config-router)#neighbor 10.10.10.2 weight 200
```

### Задание 2

Топология и компания те же.

Решив вопрос с исходящим трафиком, через некоторое время вы заметили, что большая часть входящего трафика поступает в вашу сеть от ISP B (AS300).   
Вас такое положение не устраивает. Теперь необходимо решить вопрос с входящим трафиком.

1. Выберите технологию управления входящим трафиком, которая с наименьшими затратами позволит решить эту задачу. 
2. Обоснуйте свой выбор.
3. Приведите пример настройки выбранной технологии, основываясь на информации отображенной на схеме.

*Приведите ответ в свободной форме.*

---

Как вариант настроить параметр **MED** и анонсировать его

```
R1(config)#route-map med-300
R1(config-route-map)#match any
R1(config-route-map)#set metric 300
R1(config)#router bgp 100
R1(config-router)#neighbor 20.20.20.2 route-map med-300 out
```

Вариант с AS pretend может не сработать т.к. неизвестны настройки на соседних AS возможно у AS200 и AS300 есть связанность и настройки AS200 Local preferens отдают предпочтение исходящему трафику в AS300 и в итоге с pretend мы все так же можем получить входящий трафик из AS 300.

Как вариант посмотреть параметры community в AS200 и попробовать использовать их.

### Задание 3

Топология и компания те же.

Решение, выбраное в Задании 2, помогло, но недостаточно. Вы пообщались с провайдерами и выяснили, что у обоих провайдеров есть политики управления трафиком, определяемые community. 

ISP A AS_200 community:
200:xxx - Local-pref to your AS

ISP B AS_300 community:
300:xxx - Local-pref to your AS

А также Вы узнали, что между ними есть прямая связь. На этом стыке установлен атрибут local-pref со значением 200 с обоих сторон. 

Теперь необходимо воспользоваться полученым знанием, чтобы улучшить свои политики управления входящим трафиком.

1. Выберите технологию управления входящим трафиком которая позволит решить эту задачу. 
2. Обоснуйте свой выбор.
3. Приведите пример настройки выбранной технологии основываясь на информации отображенной на схеме.

*Приведите ответ в свободной форме.*

---

Перечитал информацию по community не могу понять как его правильно использовать. Какие community должны быть созданы в 200 и 300, как их применятьв 100, не понятно.


## Дополнительные задания (со звездочкой*)

Эти задания дополнительные (не обязательные к выполнению) и никак не повлияют на получение вами зачета по этому домашнему заданию. Вы можете их выполнить, если хотите глубже и/или шире разобраться в материале.

### Задание 4*

Топология и компания те же, но сетевое оборудование Juniper.

Стоит задача - максимально использовать первый канал для доступа в сеть Интернет.

1. Выберите технологию управления исходящим трафиком, которая с наименьшими затратами позволит решить эту задачу. 
2. Обоснуйте свой выбор.
3. Приведите пример настройки выбранной технологии основываясь на информации отображенной на схеме.

*Приведите ответ в свободной форме.*

---

Самое простое в этом случае настроить Local Preference, т.к. все что нам нужно отдать предпочтение исходящему трафику идти в АС 200

```
[edit interfaces]
user@R1# set fe-1/2/0 unit 0 family inet address 10.10.10.1/30
user@R1# set fe-1/2/1 unit 0 family inet address 20.20.20.1/30
user@R1# set lo0 unit 0 family inet address 192.168.0.2/32

[edit routing-options]
user@R1# set autonomous-system 200

[edit policy-options policy-statement send-direct term 1]
user@R1# set from protocol direct
user@R1# set then accept

[edit policy-options policy-statement set-preference]
user@R1# set term term1 from protocol bgp
user@R1# set term term1 from next-hop 10.10.10.2
user@R1# set term term1 then preference 15
user@R1# set term term2 from protocol bgp
user@R1# set term term2 from next-hop 20.20.20.2
user@R1# set term term2 then preference 10

[edit protocols bgp group ext]
user@R1# set type external
user@R1# set export send-direct
user@R1# set neighbor 10.10.10.2 peer-as 200
user@R1# set neighbor 20.20.20.2 peer-as 300

[edit protocols bgp group ext]
user@R1# set import set-preference

```